{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Ajuda Administraci√≥ - CoopConsum{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
  /* Adaptar colors per tema fosc de Django admin */
  .admin-help-section {
    margin-bottom: 2rem;
    background: #2b2b2b;
    border: 1px solid #444;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    overflow: hidden;
  }
  
  .admin-help-header {
    background: #417690;
    color: white;
    padding: 1rem 1.5rem;
    font-size: 1.2rem;
    font-weight: 600;
  }
  
  .admin-help-content {
    padding: 1.5rem;
    color: #f2f2f2;
  }
  
  .admin-help-content h4 {
    color: #79aec8;
    margin-top: 0;
  }
  
  .admin-help-content h5 {
    color: #79aec8;
  }
  
  .admin-help-content p {
    color: #e0e0e0;
    line-height: 1.6;
  }
  
  .admin-help-content ul li {
    color: #e0e0e0;
  }
  
  .admin-help-content strong {
    color: #ffffff;
  }
  
  .admin-help-content code {
    background: #1a1a1a;
    color: #79aec8;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    border: 1px solid #444;
  }
  
  .admin-help-search {
    margin-bottom: 2rem;
    padding: 1rem;
    background: #1a1a1a;
    border: 1px solid #444;
    border-radius: 8px;
  }
  
  .step-number {
    background: #417690;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 0.5rem;
  }
  
  .admin-help-toc {
    position: sticky;
    top: 20px;
    background: #2b2b2b;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .admin-help-toc h3 {
    color: #79aec8 !important;
    margin-top: 0;
  }
  
  .admin-help-toc a {
    display: block;
    padding: 0.5rem;
    color: #79aec8;
    text-decoration: none;
    border-radius: 4px;
    transition: background-color 0.2s;
  }
  
  .admin-help-toc a:hover,
  .admin-help-toc a.active {
    background-color: #417690;
    color: white;
  }
  
  .workflow-step {
    border-left: 4px solid #417690;
    padding-left: 1rem;
    margin-bottom: 1rem;
    background: rgba(65, 118, 144, 0.1);
    padding: 1rem;
    border-radius: 0 4px 4px 0;
  }
  
  .workflow-step p {
    margin: 0.5rem 0;
  }
  
  .alert-admin {
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 4px;
    border-left: 4px solid #ffc107;
    background-color: rgba(255, 193, 7, 0.2);
    color: #fff3cd;
    border: 1px solid #ffc107;
  }
  
  .alert-admin strong {
    color: #ffc107;
  }
  
  .alert-admin a {
    color: #79aec8;
  }
  
  .admin-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
    background: #1a1a1a;
    min-height: 100vh;
  }
  
  .admin-container h1 {
    color: #79aec8 !important;
    margin-bottom: 2rem;
  }
  
  /* Ajustar input de cerca per tema fosc */
  .admin-help-search input {
    background: #2b2b2b;
    color: #f2f2f2;
    border: 1px solid #444;
  }
  
  .admin-help-search input::placeholder {
    color: #999;
  }
  
  .admin-help-search button {
    background: #417690;
    color: white;
    border: none;
  }
  
  .admin-help-search button:hover {
    background: #5a94b8;
  }
  
  /* Grid responsive per tema fosc */
  @media (max-width: 768px) {
    .admin-container > div {
      grid-template-columns: 1fr !important;
    }
    
    .admin-help-toc {
      position: static;
      margin-bottom: 2rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
  <h1 style="color: #417690; margin-bottom: 2rem;">
    <i class="fas fa-cogs"></i> Centre d'Ajuda - Administraci√≥
  </h1>
  
  <!-- Barra de cerca -->
  <div class="admin-help-search">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <input type="text" 
             id="adminSearchHelp" 
             placeholder="Cerca ajuda espec√≠fica d'administraci√≥..." 
             style="flex: 1; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;"
             onkeyup="searchAdminHelp()">
      <button onclick="clearSearch()" style="padding: 0.5rem 1rem; background: #417690; color: white; border: none; border-radius: 4px;">
        Neteja
      </button>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: 250px 1fr; gap: 2rem;">
    <!-- √çndex de continguts -->
    <div class="admin-help-toc">
      <h3 style="margin-top: 0; color: #417690;">Continguts</h3>
      <a href="#primers-passos" onclick="scrollToSection('primers-passos')">Primers Passos Admin</a>
      <a href="#gestio-usuaris" onclick="scrollToSection('gestio-usuaris')">Gesti√≥ d'Usuaris</a>
      <a href="#validacio-ingressos" onclick="scrollToSection('validacio-ingressos')">Validaci√≥ d'Ingressos</a>
      <a href="#gestio-comandes" onclick="scrollToSection('gestio-comandes')">Gesti√≥ de Comandes</a>
      <a href="#configuracio-sistema" onclick="scrollToSection('configuracio-sistema')">Configuraci√≥ Sistema</a>
      <a href="#manteniment" onclick="scrollToSection('manteniment')">Manteniment</a>
      <a href="#troubleshooting-admin" onclick="scrollToSection('troubleshooting-admin')">Troubleshooting</a>
    </div>

    <!-- Contingut principal -->
    <div>
      <!-- Primers Passos Admin -->
      <div id="primers-passos" class="admin-help-section">
        <div class="admin-help-header">
          üöÄ Primers Passos d'Administraci√≥
        </div>
        <div class="admin-help-content">
          <p><strong>Benvingut al panel d'administraci√≥ de CoopConsum!</strong> Aqu√≠ trobar√†s les tasques essencials per gestionar la cooperativa.</p>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem;">
            <div>
              <h4><span class="step-number">1</span>Acc√©s i Navegaci√≥</h4>
              <ul>
                <li>URL: <code>/admin/</code></li>
                <li>Credencials de superusuari necess√†ries</li>
                <li>Navegaci√≥ per m√≤duls al lateral esquerre</li>
                <li>Canvia contrasenya al primer acc√©s</li>
              </ul>
            </div>
            <div>
              <h4><span class="step-number">2</span>Tasques Di√†ries</h4>
              <ul>
                <li><strong>Validar ingressos</strong> pendents</li>
                <li><strong>Revisar comandes</strong> en estat pendent</li>
                <li><strong>Gestionar usuaris</strong> nous</li>
                <li><strong>Comprovar configuraci√≥</strong> del sistema</li>
              </ul>
            </div>
          </div>
          
          <div class="alert-admin">
            <strong>üí° Consell Important:</strong> Sempre fes backup abans de fer canvis importants al sistema.
          </div>
        </div>
      </div>

      <!-- Gesti√≥ d'Usuaris -->
      <div id="gestio-usuaris" class="admin-help-section">
        <div class="admin-help-header">
          üë• Gesti√≥ d'Usuaris i Permisos
        </div>
        <div class="admin-help-content">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
            <div>
              <h4>Crear Nou Soci</h4>
              <div class="workflow-step">
                <p><strong>Pas 1:</strong> Anar a "Socios" ‚Üí "Socios" ‚Üí "A√±adir Socio"</p>
                <p><strong>Pas 2:</strong> Omple dades obligat√≤ries: nom, email, n√∫mero UF</p>
                <p><strong>Pas 3:</strong> Crear usuari associat si cal acc√©s a la intranet</p>
                <p><strong>Pas 4:</strong> Assignar permisos especials si escau</p>
              </div>
            </div>
            <div>
              <h4>Permisos Especials</h4>
              <ul>
                <li><strong>gestiona_productos:</strong> Pot afegir/editar productes</li>
                <li><strong>gestiona_stock:</strong> Pot gestionar inventari</li>
                <li><strong>puede_crear_comandas_esporadicas:</strong> Pot crear comandes especials</li>
              </ul>
              
              <h4>Activar/Desactivar Usuaris</h4>
              <p>Marca/desmarca "Activo" per permetre/bloquejar l'acc√©s.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Validaci√≥ d'Ingressos -->
      <div id="validacio-ingressos" class="admin-help-section">
        <div class="admin-help-header">
          üí∞ Validaci√≥ d'Ingressos del Moneder
        </div>
        <div class="admin-help-content">
          <h4>Workflow de Validaci√≥</h4>
          <div class="workflow-step">
            <p><strong>1. Localitzar ingressos pendents:</strong></p>
            <p>Anar a "Socios" ‚Üí "Movimientos Cuenta" ‚Üí Filtrar per "Estado: Pendiente"</p>
          </div>
          <div class="workflow-step">
            <p><strong>2. Verificar justificant:</strong></p>
            <p>Comprovar transfer√®ncia banc√†ria o ingr√©s en efectiu</p>
          </div>
          <div class="workflow-step">
            <p><strong>3. Validar o rebutjar:</strong></p>
            <p>Canviar estat a "Validado" o eliminar si no √©s correcte</p>
          </div>
          
          <div class="alert-admin">
            <strong>‚ö†Ô∏è Important:</strong> El saldo del soci s'actualitza autom√†ticament quan valides l'ingr√©s.
          </div>
        </div>
      </div>

      <!-- Gesti√≥ de Comandes -->
      <div id="gestio-comandes" class="admin-help-section">
        <div class="admin-help-header">
          üõí Gesti√≥ de Comandes i Pedidos Col¬∑lectius
        </div>
        <div class="admin-help-content">
          <h4>Estats de Comandes</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
              <p><strong>üü¢ OBERT:</strong> Socis poden participar</p>
              <p><strong>üü° PENDENT:</strong> Gestors revisen</p>
            </div>
            <div>
              <p><strong>üîÑ REVISI√ì:</strong> Master ha fet correccions</p>
              <p><strong>‚ö´ INACTIU:</strong> Finalitzada, descompte fet</p>
            </div>
          </div>
          
          <h4>Comandes Recurrents</h4>
          <div class="workflow-step">
            <p><strong>Crear:</strong> "Pedidos" ‚Üí "Comandas Recurrentes" ‚Üí "A√±adir"</p>
            <p><strong>‚ö†Ô∏è Important:</strong> NO posar data de finalitzaci√≥ (pot crear problemes de visualitzaci√≥)</p>
            <p><strong>Assignar:</strong> Responsable gestor per cada comanda</p>
          </div>
          
          <h4>Revisar Participacions</h4>
          <p>A "Pedidos Col¬∑lectius" pots veure totes les participacions i fer ajustos abans de finalitzar.</p>
        </div>
      </div>

      <!-- Configuraci√≥ Sistema -->
      <div id="configuracio-sistema" class="admin-help-section">
        <div class="admin-help-header">
          ‚öôÔ∏è Configuraci√≥ del Sistema
        </div>
        <div class="admin-help-content">
          <h4>ConfiguracioWeb</h4>
          <p>Configuraci√≥ principal del sistema a "Web" ‚Üí "Configuracio Webs":</p>
          <ul>
            <li><strong>Nom cooperativa:</strong> Apareix a tota la web</li>
            <li><strong>Descripci√≥:</strong> Text de presentaci√≥</li>
            <li><strong>Contacte:</strong> Email i tel√®fon</li>
            <li><strong>Configuraci√≥ API:</strong> Activar/desactivar API p√∫blica</li>
          </ul>
          
          <h4>Galeria d'Imatges</h4>
          <p>Gestiona imatges p√∫bliques a "Web" ‚Üí "Galeria Imagens"</p>
          
          <h4>Categories i Prove√Ødors</h4>
          <p>Configura visibilitat p√∫blica marcant "Visible en web"</p>
        </div>
      </div>

      <!-- Manteniment -->
      <div id="manteniment" class="admin-help-section">
        <div class="admin-help-header">
          üîß Manteniment i Monitoritzaci√≥
        </div>
        <div class="admin-help-content">
          <h4>Tasques de Manteniment</h4>
          <ul>
            <li><strong>Backup diari:</strong> Autom√†tic a les 02:00</li>
            <li><strong>Logs:</strong> Revisar errors al sistema</li>
            <li><strong>Espai disc:</strong> Monitoritzar media files</li>
            <li><strong>Usuaris inactius:</strong> Revisar peri√≤dicament</li>
          </ul>
          
          <h4>Comandes Autom√†tiques</h4>
          <p>Els cron jobs executen:</p>
          <ul>
            <li><strong>23:58:</strong> Generar noves comandes recurrents</li>
            <li><strong>23:59:</strong> Tancar comandes del dia</li>
            <li><strong>02:00:</strong> Backup de base de dades</li>
          </ul>
        </div>
      </div>

      <!-- Troubleshooting Admin -->
      <div id="troubleshooting-admin" class="admin-help-section">
        <div class="admin-help-header">
          üõ†Ô∏è Resoluci√≥ de Problemes Comuns
        </div>
        <div class="admin-help-content">
          <h4>Problemes Freq√ºents</h4>
          
          <div class="workflow-step">
            <h5>Soci no pot accedir a la intranet</h5>
            <p>1. Verificar que t√© usuari creat</p>
            <p>2. Comprovar que est√† "Activo"</p>
            <p>3. Revisar permisos assignats</p>
          </div>
          
          <div class="workflow-step">
            <h5>Comandes no es veuen a la intranet</h5>
            <p>1. Comprovar dates d'obertura/tancament</p>
            <p>2. Revisar solapament entre comandes setmanals</p>
            <p>3. Verificar estat de la comanda</p>
          </div>
          
          <div class="workflow-step">
            <h5>Problemes amb el moneder</h5>
            <p>1. Revisar moviments pendents de validaci√≥</p>
            <p>2. Comprovar que no hi ha moviments duplicats</p>
            <p>3. Verificar que els imports s√≥n correctes</p>
          </div>
          
          <div class="alert-admin">
            <strong>üìû Suport T√®cnic:</strong> 
            <a href="mailto:civada@gmail.com">civada@gmail.com</a> | 
            <a href="https://github.com/fosc19/coopconsum/issues" target="_blank">GitHub Issues</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Cerca en el contingut d'ajuda admin
function searchAdminHelp() {
  const searchTerm = document.getElementById('adminSearchHelp').value.toLowerCase();
  const sections = document.querySelectorAll('.admin-help-section');
  
  sections.forEach(section => {
    const text = section.textContent.toLowerCase();
    if (text.includes(searchTerm) || searchTerm === '') {
      section.style.display = 'block';
    } else {
      section.style.display = 'none';
    }
  });
}

function clearSearch() {
  document.getElementById('adminSearchHelp').value = '';
  searchAdminHelp();
}

function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    element.scrollIntoView({ behavior: 'smooth' });
    
    // Actualitzar enlla√ß actiu
    document.querySelectorAll('.admin-help-toc a').forEach(link => {
      link.classList.remove('active');
    });
    document.querySelector(`a[href="#${sectionId}"]`).classList.add('active');
  }
}

// Scroll spy per actualitzar navegaci√≥
window.addEventListener('scroll', function() {
  const sections = document.querySelectorAll('.admin-help-section');
  const tocLinks = document.querySelectorAll('.admin-help-toc a');
  
  let currentSection = '';
  sections.forEach(section => {
    const rect = section.getBoundingClientRect();
    if (rect.top <= 100 && rect.bottom >= 100) {
      currentSection = section.id;
    }
  });
  
  tocLinks.forEach(link => {
    link.classList.remove('active');
    const href = link.getAttribute('href');
    if (href === `#${currentSection}`) {
      link.classList.add('active');
    }
  });
});
</script>
{% endblock %}